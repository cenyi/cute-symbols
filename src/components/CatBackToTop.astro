---
/**
 * CATä¸»é¢˜çš„å›åˆ°é¡¶éƒ¨æŒ‰é’®
 * å¯çˆ±çš„çŒ«å’ªè®¾è®¡ï¼Œå¹³æ»‘æ»šåŠ¨åˆ°é¡¶éƒ¨
 */
---

<button
  id="cat-back-to-top"
  class="cat-back-to-top"
  style={{
    position: 'fixed',
    bottom: '2rem',
    right: '2rem',
    width: '60px',
    height: '60px',
    background: 'linear-gradient(135deg, var(--accent-color) 0%, #ff8fab 100%)',
    border: 'none',
    borderRadius: '50%',
    cursor: 'pointer',
    display: 'flex',
    alignItems: 'center',
    justifyContent: 'center',
    fontSize: '1.75rem',
    color: '#ffffff',
    boxShadow: '0 4px 20px rgba(255, 107, 157, 0.3)',
    transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
    zIndex: 1000,
    opacity: 0,
    visibility: 'hidden',
    transform: 'translateY(20px) scale(0.8)'
  }}
  aria-label="Back to top"
  title="Back to top"
>
  <span class="cat-emoji" style={{
    display: 'inline-block',
    transition: 'transform 0.3s ease',
    filter: 'drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2))'
  }}>
    ğŸ±
  </span>
</button>

<style>
  .cat-back-to-top.visible {
    opacity: 1;
    visibility: visible;
    transform: translateY(0) scale(1);
  }

  .cat-back-to-top:hover {
    transform: translateY(-4px) scale(1.1);
    box-shadow: 0 8px 30px rgba(255, 107, 157, 0.4);
    background: linear-gradient(135deg, #ff5a8d 0%, #ff7aa3 100%);
  }

  .cat-back-to-top:hover .cat-emoji {
    transform: scale(1.2) rotate(-10deg);
    animation: catBounce 0.6s ease-in-out;
  }

  .cat-back-to-top:active {
    transform: translateY(-2px) scale(1.05);
  }

  @keyframes catBounce {
    0%, 100% { transform: scale(1.2) rotate(-10deg); }
    50% { transform: scale(1.3) rotate(10deg); }
  }

  /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
  @media (max-width: 768px) {
    .cat-back-to-top {
      width: 50px !important;
      height: 50px !important;
      bottom: 1.5rem !important;
      right: 1.5rem !important;
      font-size: 1.5rem !important;
    }
  }

  /* å‡å°‘åŠ¨ç”»å¯¹äºåå¥½å‡å°‘åŠ¨ç”»çš„ç”¨æˆ· */
  @media (prefers-reduced-motion: reduce) {
    .cat-back-to-top,
    .cat-emoji {
      transition: none !important;
      animation: none !important;
    }
  }

  /* é«˜å¯¹æ¯”åº¦æ¨¡å¼æ”¯æŒ */
  @media (prefers-contrast: high) {
    .cat-back-to-top {
      border: 2px solid #000000;
      background: #ff6b9d !important;
    }
  }
</style>

<script>
  // å›åˆ°é¡¶éƒ¨åŠŸèƒ½
  document.addEventListener('DOMContentLoaded', () => {
    const backToTopBtn = document.getElementById('cat-back-to-top');
    if (!backToTopBtn) return;

    // æ˜¾ç¤º/éšè—æŒ‰é’®çš„é˜ˆå€¼
    const showThreshold = 300;

    // æ»šåŠ¨ç›‘å¬
    const handleScroll = () => {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      
      if (scrollTop > showThreshold) {
        backToTopBtn.classList.add('visible');
      } else {
        backToTopBtn.classList.remove('visible');
      }
    };

    // å¹³æ»‘æ»šåŠ¨åˆ°é¡¶éƒ¨
    const scrollToTop = () => {
      // ä½¿ç”¨ç°ä»£çš„ scrollTo API
      if ('scrollBehavior' in document.documentElement.style) {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      } else {
        // é™çº§å¤„ç†ï¼šæ‰‹åŠ¨å®ç°å¹³æ»‘æ»šåŠ¨
        const scrollStep = -window.scrollY / (500 / 15);
        const scrollInterval = setInterval(() => {
          if (window.scrollY !== 0) {
            window.scrollBy(0, scrollStep);
          } else {
            clearInterval(scrollInterval);
          }
        }, 15);
      }

      // æ·»åŠ ç‚¹å‡»åé¦ˆ
      backToTopBtn.style.transform = 'translateY(-2px) scale(1.05)';
      setTimeout(() => {
        backToTopBtn.style.transform = '';
      }, 150);
    };

    // äº‹ä»¶ç›‘å¬
    window.addEventListener('scroll', handleScroll, { passive: true });
    backToTopBtn.addEventListener('click', scrollToTop);

    // é”®ç›˜æ”¯æŒ
    backToTopBtn.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        scrollToTop();
      }
    });

    // åˆå§‹æ£€æŸ¥
    handleScroll();

    // é¡µé¢å¯è§æ€§å˜åŒ–æ—¶é‡æ–°æ£€æŸ¥
    document.addEventListener('visibilitychange', () => {
      if (!document.hidden) {
        handleScroll();
      }
    });
  });

  // æ·»åŠ ä¸€äº›æœ‰è¶£çš„äº¤äº’æ•ˆæœ
  document.addEventListener('DOMContentLoaded', () => {
    const backToTopBtn = document.getElementById('cat-back-to-top');
    if (!backToTopBtn) return;

    // éšæœºçŒ«å’ªè¡¨æƒ…
    const catEmojis = ['ğŸ±', 'ğŸ˜¸', 'ğŸ˜º', 'ğŸ˜»', 'ğŸ™€', 'ğŸ˜¿', 'ğŸ˜¾'];
    let currentEmojiIndex = 0;

    // æ¯æ¬¡ç‚¹å‡»åˆ‡æ¢çŒ«å’ªè¡¨æƒ…
    backToTopBtn.addEventListener('click', () => {
      const catEmoji = backToTopBtn.querySelector('.cat-emoji');
      if (catEmoji) {
        currentEmojiIndex = (currentEmojiIndex + 1) % catEmojis.length;
        catEmoji.textContent = catEmojis[currentEmojiIndex];
      }
    });

    // é•¿æ—¶é—´æ‚¬åœæ—¶çš„ç‰¹æ®Šæ•ˆæœ
    let hoverTimeout: ReturnType<typeof setTimeout>;
    backToTopBtn.addEventListener('mouseenter', () => {
      hoverTimeout = setTimeout(() => {
        const catEmoji = backToTopBtn.querySelector('.cat-emoji');
        if (catEmoji) {
          catEmoji.textContent = 'ğŸ˜¸'; // å¼€å¿ƒçš„çŒ«å’ª
        }
      }, 1000);
    });

    backToTopBtn.addEventListener('mouseleave', () => {
      clearTimeout(hoverTimeout);
      const catEmoji = backToTopBtn.querySelector('.cat-emoji');
      if (catEmoji) {
        catEmoji.textContent = 'ğŸ±'; // æ¢å¤é»˜è®¤
      }
    });
  });
</script>