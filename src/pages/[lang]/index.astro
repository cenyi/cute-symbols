---
/**
 * å¤šè¯­è¨€é¦–é¡µ - æç®€Hero + ç¬¦å·å¢™è®¾è®¡
 * ä¸è‹±æ–‡é¦–é¡µä¿æŒå®Œå…¨ä¸€è‡´çš„å¸ƒå±€å’ŒåŠŸèƒ½
 */
import type { GetStaticPaths } from 'astro';
import Layout from '../../layouts/Layout.astro';
import { getTranslations } from '../../i18n/utils';
import { type Locale } from '../../i18n/config';
import PlatformGuide from '../../components/PlatformGuide.astro';
import SymbolGridApi from '../../components/SymbolGridApi.astro';
import CategoryTabs from '../../components/CategoryTabs.astro';
import FAQ from '../../components/FAQ.astro';
import CatBackToTop from '../../components/CatBackToTop.astro';
import indexData from '../../data/symbols/index.json';
import { locales } from '../../i18n/config';

export const prerender = true;

export const getStaticPaths: GetStaticPaths = () => {
  return locales.filter(locale => locale !== 'en').map((locale) => ({
    params: { lang: locale },
    props: { locale }
  }));
};

interface Props {
  locale: Locale;
}

const locale = (Astro.props.locale || Astro.params.lang) as Locale;
const { t } = getTranslations(locale);

const stats = {
  total: indexData.stats.totalSymbols,
  totalCategories: indexData.stats.totalCategories
};
---

<Layout title={t('site.title')} locale={locale}>
  <!-- SEO Meta Tags -->
  <meta name="description" content={t('site.description')} />
  <meta name="keywords" content={t('seo.keywords')} />
  <link rel="canonical" href={`https://cute-symbols.uk/${locale}/`} />

  <!-- Open Graph -->
  <meta property="og:title" content={t('site.title')} />
  <meta property="og:description" content={t('site.description')} />
  <meta property="og:type" content="website" />

  <!-- JSON-LD ç»“æ„åŒ–æ•°æ® -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    "name": t('site.title'),
    "description": t('site.description'),
    "url": `https://cute-symbols.uk/${locale}/`,
    "numberOfItems": stats.total
  })} />

  <div style={{
    maxWidth: '1600px',
    margin: '0 auto',
    padding: '0.5rem 1rem 2rem'
  }}>

    <!-- æç®€HeroåŒºåŸŸ (40vh) -->
    <div style={{
      textAlign: 'center',
      padding: '1.5rem 0 1rem',
      borderBottom: '1px solid var(--border-color)',
      marginBottom: '1rem'
    }}>
      <!-- ä¸€è¡Œæ ‡é¢˜ -->
      <h1 style={{
        fontSize: 'clamp(1.5rem, 4vw, 2rem)',
        fontWeight: 700,
        margin: '0 0 0.5rem 0',
        color: 'var(--text-primary)',
        letterSpacing: '-0.02em',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        gap: '0.5rem',
        flexWrap: 'wrap'
      }}>
        <span style={{
          background: 'linear-gradient(135deg, var(--accent-color) 0%, #ffa07a 100%)',
          WebkitBackgroundClip: 'text',
          WebkitTextFillColor: 'transparent',
          backgroundClip: 'text'
        }}>
          {t('site.title')}
        </span>
      </h1>

      <!-- ä¸€å¥è¯æè¿° -->
      <p style={{
        fontSize: '0.9375rem',
        color: 'var(--text-secondary)',
        margin: '0 0 1rem 0',
        fontWeight: 500
      }}>
        <span>{t('common.copyPaste')}</span> <span style={{ color: 'var(--accent-color)', fontWeight: 700 }}>{stats.total}+</span> <span>{t('stats.symbols')}</span> <span style={{ color: 'var(--accent-color)', fontWeight: 700 }}>{t('common.oneClick')}</span>
      </p>

      <!-- ç´§å‡‘æœç´¢æ¡† -->
      <div style={{
        maxWidth: '400px',
        margin: '0 auto 1rem',
        display: 'flex',
        gap: '0.5rem'
      }}>
        <input
          type="text"
          id="search-input"
          placeholder={t('nav.search') || 'Search symbols...'}
          style={{
            flex: 1,
            padding: '0.5rem 0.75rem',
            border: '1px solid var(--border-color)',
            borderRadius: 'var(--radius-md)',
            fontSize: '0.875rem',
            background: 'var(--card-bg)',
            color: 'var(--text-primary)'
          }}
        />
        <button
          id="clear-btn"
          type="button"
          style={{
            padding: '0.5rem 1rem',
            background: 'var(--card-bg)',
            color: 'var(--text-secondary)',
            border: '1px solid var(--border-color)',
            borderRadius: 'var(--radius-md)',
            fontSize: '0.875rem',
            fontWeight: 600,
            cursor: 'pointer',
            transition: 'all 0.2s ease',
            display: 'none'
          }}
        >
          âœ•
        </button>
        <button
          id="search-btn"
          type="button"
          style={{
            padding: '0.5rem 1rem',
            background: 'var(--accent-color)',
            color: '#ffffff',
            border: 'none',
            borderRadius: 'var(--radius-md)',
            fontSize: '0.875rem',
            fontWeight: 600,
            cursor: 'pointer',
            transition: 'background 0.2s ease'
          }}
        >
          ğŸ”
        </button>
      </div>

      <!-- æœç´¢ç»“æœå®¹å™¨ -->
      <div id="search-results" style={{
        maxWidth: '1200px',
        margin: '0 auto 1rem',
        display: 'none'
      }}>
        <div style={{
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'space-between',
          marginBottom: '1rem',
          padding: '0 1rem'
        }}>
          <h2 id="search-results-title" style={{
            fontSize: '1.25rem',
            fontWeight: 600,
            margin: 0,
            color: 'var(--text-primary)'
          }}>
            ğŸ” {t('common.searchResults') || 'Search Results'}
          </h2>
          <span id="search-results-count" style={{
            fontSize: '0.875rem',
            color: 'var(--text-secondary)'
          }}></span>
        </div>
        <div id="search-results-grid" style={{
          display: 'flex',
          flexWrap: 'wrap',
          gap: '0.5rem',
          minHeight: '100px',
          padding: '1rem',
          background: 'var(--card-bg)',
          border: '1px solid var(--border-color)',
          borderRadius: 'var(--radius-lg)'
        }}></div>
      </div>
    </div>

    <!-- ç´§å‡‘åˆ†ç±»æ ‡ç­¾ -->
    <CategoryTabs
      {locale}
      activeCategory="all"
      baseUrl={`/${locale}`}
    />

    <!-- ç¬¦å·å¢™ (80vh) - ç«‹å³æ˜¾ç¤ºï¼ -->
    <div style={{ marginTop: '1rem' }}>
      <!-- åŠ¨æ€ç¬¦å·ç½‘æ ¼å®¹å™¨ -->
      <div id="dynamic-symbol-grid" style={{
        minHeight: '400px'
      }}>
        <!-- é»˜è®¤æ˜¾ç¤ºçƒ­é—¨åˆ†ç±»ç½‘æ ¼ -->
        <SymbolGridApi category="hearts" limit={32} title={t('categories.hearts')} {locale} />
        <SymbolGridApi category="stars" limit={32} title={t('categories.stars')} style={{ marginTop: '2rem' }} {locale} />
        <SymbolGridApi category="flowers" limit={32} title={t('categories.flowers')} style={{ marginTop: '2rem' }} {locale} />
        <SymbolGridApi category="kaomoji" limit={32} title={t('categories.kaomoji')} style={{ marginTop: '2rem' }} {locale} />
      </div>
    </div>

    <!-- SEO å†…å®¹åŒºåŸŸ (åœ¨åº•éƒ¨ï¼Œä¸å ç”¨é¦–å±) -->
    <div style={{ marginTop: '4rem', paddingTop: '2rem', borderTop: '1px solid var(--border-color)' }}>
      <!-- å¹³å°æŒ‡å— -->
      <PlatformGuide {locale} />
      
      <!-- FAQ éƒ¨åˆ† -->
      <FAQ {locale} />
    </div>
  </div>

  <!-- CAT å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
  <CatBackToTop />

  <style is:global>
    /* å…¨å±€æ ·å¼ */
    :root {
      --bg-color: #f5f5f7;
      --card-bg: #ffffff;
      --text-primary: #1a1a1a;
      --text-secondary: #666666;
      --accent-color: #ff6b9d;
      --accent-hover: #ff5a8d;
      --border-color: #e1e4e8;
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
      --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
      --radius-md: 8px;
      --radius-lg: 12px;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg-color: #0a0a0a;
        --card-bg: #1f1f1f;
        --text-primary: #e8e8e8;
        --text-secondary: #a0a0a0;
        --border-color: #2a2a2a;
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);
        --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.3);
      }
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      background: var(--bg-color);
      color: var(--text-primary);
    }

    button:hover {
      background: var(--accent-hover) !important;
    }
  </style>

  <style>
    input:focus {
      outline: none;
      border-color: var(--accent-color) !important;
    }

    /* æ¸…é™¤æŒ‰é’®æ‚¬åœæ•ˆæœ */
    #clear-btn:hover {
      background: var(--bg-color) !important;
      border-color: var(--accent-color) !important;
      color: var(--accent-color) !important;
    }

    /* å“åº”å¼ä¼˜åŒ– */
    @media (max-width: 768px) {
      h1 {
        font-size: 1.25rem !important;
      }

      form {
        max-width: 100% !important;
      }
    }
  </style>

  <script define:vars={{ t, locale }}>
    // æ ‡ç­¾ç¿»è¯‘æ˜ å°„
    const tagTranslations = {
      en: {
        'white': 'white', 'black': 'black', 'red': 'red', 'pink': 'pink',
        'blue': 'blue', 'purple': 'purple', 'yellow': 'yellow', 'gold': 'gold',
        'outline': 'outline', 'solid': 'solid', 'minimalist': 'minimalist',
        'cute': 'cute', 'elegant': 'elegant', 'fancy': 'fancy', 'classic': 'classic',
        'sparkling': 'sparkling', 'heart': 'heart', 'star': 'star', 'flower': 'flower'
      },
      fil: {
        'white': 'puti', 'black': 'itim', 'red': 'pula', 'pink': 'rosas',
        'blue': 'asul', 'purple': 'lila', 'yellow': 'dilaw', 'gold': 'ginto',
        'outline': 'outline', 'solid': 'solid', 'minimalist': 'minimalista',
        'cute': 'cute', 'elegant': 'elegante', 'fancy': 'punky', 'classic': 'klasiko',
        'sparkling': 'kumikislap', 'heart': 'puso', 'star': 'bituin', 'flower': 'bulaklak'
      },
      ms: {
        'white': 'putih', 'black': 'hitam', 'red': 'merah', 'pink': 'merah jambu',
        'blue': 'biru', 'purple': 'ungu', 'yellow': 'kuning', 'gold': 'emas',
        'outline': 'garis luar', 'solid': 'pejal', 'minimalist': 'minimum',
        'cute': 'comel', 'elegant': 'elegan', 'fancy': 'fancy', 'classic': 'klasik',
        'sparkling': 'berkilau', 'heart': 'jantung', 'star': 'bintang', 'flower': 'bunga'
      },
      bn: {
        'white': 'à¦¸à¦¾à¦¦à¦¾', 'black': 'à¦•à¦¾à¦²à§‹', 'red': 'à¦²à¦¾à¦²', 'pink': 'à¦—à§‹à¦²à¦¾à¦ªà¦¿',
        'blue': 'à¦¨à§€à¦²', 'purple': 'à¦¬à§‡à¦—à§à¦¨à¦¿', 'yellow': 'à¦¹à¦²à§à¦¦', 'gold': 'à¦¸à§‹à¦¨à¦¾à¦²à§€',
        'outline': 'à¦†à¦‰à¦Ÿà¦²à¦¾à¦‡à¦¨', 'solid': 'à¦¸à¦²à¦¿à¦¡', 'minimalist': 'à¦®à¦¿à¦¨à¦¿à¦®à¦¾à¦²à¦¿à¦¸à§à¦Ÿ',
        'cute': 'à¦•à¦¿à¦‰à¦Ÿ', 'elegant': 'à¦à¦²à¦¿à¦—à§à¦¯à¦¾à¦¨à§à¦Ÿ', 'fancy': 'à¦«à§à¦¯à¦¾à¦¨à§à¦¸à¦¿', 'classic': 'à¦•à§à¦²à¦¾à¦¸à¦¿à¦•',
        'sparkling': 'à¦à¦•à¦®à¦•à§‡', 'heart': 'à¦¹à¦¾à¦°à§à¦Ÿ', 'star': 'à¦¤à¦¾à¦°à¦¾', 'flower': 'à¦«à§à¦²'
      },
      pl: {
        'white': 'biaÅ‚y', 'black': 'czarny', 'red': 'czerwony', 'pink': 'rÃ³Å¼owy',
        'blue': 'niebieski', 'purple': 'fioletowy', 'yellow': 'Å¼Ã³Å‚ty', 'gold': 'zÅ‚oty',
        'outline': 'kontur', 'solid': 'solidny', 'minimalist': 'minimalistyczny',
        'cute': 'sÅ‚odki', 'elegant': 'elegancki', 'fancy': 'fancy', 'classic': 'klasyczny',
        'sparkling': 'bÅ‚yszczÄ…cy', 'heart': 'serce', 'star': 'gwiazda', 'flower': 'kwiat'
      }
    };

    const tagTranslation = tagTranslations[locale] || tagTranslations.en;

    // ç¿»è¯‘æ ‡ç­¾å‡½æ•°
    function translateTag(tag) {
      return tagTranslation[tag] || tag;
    }

    // ==================== å®æ—¶æœç´¢åŠŸèƒ½ ====================
    const searchInput = document.getElementById('search-input');
    const clearBtn = document.getElementById('clear-btn');
    const searchBtn = document.getElementById('search-btn');
    const searchResults = document.getElementById('search-results');
    const searchResultsGrid = document.getElementById('search-results-grid');
    const searchResultsTitle = document.getElementById('search-results-title');
    const searchResultsCount = document.getElementById('search-results-count');

    let searchTimeout = null;

    // æœç´¢è¾“å…¥ç›‘å¬ï¼ˆå®æ—¶æœç´¢ï¼Œé˜²æŠ–ï¼‰
    searchInput?.addEventListener('input', (e) => {
      const query = e.target.value.trim();

      // æ˜¾ç¤º/éšè—æ¸…é™¤æŒ‰é’®
      if (query) {
        clearBtn.style.display = 'block';
      } else {
        clearBtn.style.display = 'none';
        hideSearchResults();
        return;
      }

      // é˜²æŠ–å¤„ç†
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        performSearch(query);
      }, 300);
    });

    // æ¸…é™¤æŒ‰é’®ç‚¹å‡»
    clearBtn?.addEventListener('click', () => {
      searchInput.value = '';
      clearBtn.style.display = 'none';
      hideSearchResults();
      searchInput.focus();
    });

    // æœç´¢æŒ‰é’®ç‚¹å‡»
    searchBtn?.addEventListener('click', () => {
      const query = searchInput.value.trim();
      if (query) {
        performSearch(query);
      }
    });

    // å›è½¦é”®æœç´¢
    searchInput?.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const query = searchInput.value.trim();
        if (query) {
          performSearch(query);
        }
      }
    });

    // æ‰§è¡Œæœç´¢
    async function performSearch(query) {
      if (!query) return;

      // æ˜¾ç¤ºæœç´¢ç»“æœå®¹å™¨
      searchResults.style.display = 'block';
      searchResultsGrid.innerHTML = `
        <div style="text-align: center; padding: 2rem; width: 100%;">
          <div style="font-size: 2rem; margin-bottom: 1rem;">â³</div>
          <p style="color: var(--text-secondary);">${t('common.searchingFor')} "${query}"...</p>
        </div>
      `;

      try {
        const response = await fetch(`/api/symbols/search?q=${encodeURIComponent(query)}`);
        const result = await response.json();

        if (result.success && result.results) {
          displaySearchResults(result.results, query);
        } else {
          searchResultsGrid.innerHTML = `
            <div style="text-align: center; padding: 2rem; width: 100%;">
              <p style="color: var(--text-secondary);">${t('common.noSymbolsFound')} "${query}"</p>
            </div>
          `;
          searchResultsCount.textContent = '';
        }
      } catch (error) {
        console.error('Search error:', error);
        searchResultsGrid.innerHTML = `
          <div style="text-align: center; padding: 2rem; width: 100%;">
            <p style="color: var(--text-secondary);">${t('common.searchFailed')}</p>
          </div>
        `;
        searchResultsCount.textContent = '';
      }
    }

    // æ˜¾ç¤ºæœç´¢ç»“æœ
    function displaySearchResults(symbols, query) {
      searchResultsCount.textContent = `${symbols.length} ${t('common.symbolsFound')}`;

      if (symbols.length === 0) {
        searchResultsGrid.innerHTML = `
          <div style="text-align: center; padding: 2rem; width: 100%;">
            <p style="color: var(--text-secondary);">${t('common.noSymbolsFound')} "${query}"</p>
            <p style="color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.5rem;">${t('common.tryDifferentKeywords')}</p>
          </div>
        `;
        return;
      }

      searchResultsGrid.innerHTML = '';

      symbols.forEach((symbol) => {
        const card = createSearchResultCard(symbol);
        searchResultsGrid.appendChild(card);
      });

      // ç»‘å®šå¤åˆ¶äº‹ä»¶
      bindCopyEvents(searchResultsGrid);
    }

    // åˆ›å»ºæœç´¢ç»“æœå¡ç‰‡
    function createSearchResultCard(symbol) {
      const card = document.createElement('div');
      card.className = 'symbol-card-wrapper';
      card.innerHTML = `
        <div class="symbol-display" style="
          font-size: 2rem;
          margin-bottom: 0.75rem;
          text-align: center;
          color: ${symbol.color || 'var(--accent-color)'};
          word-break: keep-all;
          white-space: nowrap;
        ">${symbol.char}</div>
        <div class="symbol-tags" style="
          display: flex;
          gap: 0.35rem;
          justify-content: center;
          flex-wrap: wrap;
          margin-bottom: 0.75rem;
          min-height: 20px;
        ">
          ${symbol.tags.slice(0, 3).map((tag) => `
            <span style="
              font-size: 0.6875rem;
              padding: 0.2rem 0.5rem;
              background: var(--bg-color);
              border-radius: 8px;
              color: var(--text-secondary);
              white-space: nowrap;
            ">${translateTag(tag)}</span>
          `).join('')}
        </div>
        <button
          class="copy-btn"
          data-symbol="${symbol.char}"
          style="
            width: 100%;
            padding: 0.5rem 0.75rem;
            font-size: 0.8125rem;
            font-weight: 600;
            background: transparent;
            color: ${symbol.color || 'var(--accent-color)'};
            border: 1.5px solid ${symbol.color || 'var(--accent-color)'};
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
          "
        >
          ${t('common.copy')}
        </button>
      `;

      card.style.cssText = `
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 0.4rem 0.6rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: inline-flex;
        flex-direction: column;
        align-items: center;
        width: fit-content;
        min-width: 60px;
        box-sizing: border-box;
      `;

      // æ·»åŠ æ‚¬åœæ•ˆæœ
      card.addEventListener('mouseenter', () => {
        card.style.transform = 'translateY(-4px)';
        card.style.boxShadow = '0 12px 24px rgba(0, 0, 0, 0.12)';
      });

      card.addEventListener('mouseleave', () => {
        card.style.transform = '';
        card.style.boxShadow = '';
      });

      return card;
    }

    // éšè—æœç´¢ç»“æœ
    function hideSearchResults() {
      searchResults.style.display = 'none';
      searchResultsGrid.innerHTML = '';
    }

    // ==================== åˆ†ç±»ç‚¹å‡»è¿‡æ»¤é€»è¾‘ ====================
    const API_BASE = '/api/symbols';

    // è·å–ç¿»è¯‘åçš„åˆ†ç±»åç§°
    function getCategoryName(category) {
      return t(`categories.${category}`) || category;
    }

    // å½“å‰é€‰ä¸­çš„åˆ†ç±»
    let currentCategory = 'all';

    // ç›‘å¬åˆ†ç±»æ ‡ç­¾ç‚¹å‡»
    document.addEventListener('click', (e) => {
      const target = e.target;
      const button = target.closest('.category-tab');

      if (button && button.hasAttribute('data-category')) {
        e.preventDefault();

        const category = button.getAttribute('data-category');

        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        document.querySelectorAll('.category-tab').forEach(btn => {
          btn.classList.remove('active');
          btn.style.background = 'var(--bg-color)';
          btn.style.color = 'var(--text-primary)';
        });

        button.classList.add('active');
        button.style.background = 'var(--accent-color)';
        button.style.color = '#ffffff';

        // åŠ è½½å¯¹åº”åˆ†ç±»çš„ç¬¦å·
        loadCategorySymbols(category);
      }
    });

    // åŠ è½½åˆ†ç±»ç¬¦å·
    async function loadCategorySymbols(category) {
      const container = document.getElementById('dynamic-symbol-grid');
      if (!container) return;

      currentCategory = category;

      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      container.innerHTML = `
        <div style="text-align: center; padding: 4rem 2rem;">
          <div style="font-size: 3rem; margin-bottom: 1rem;">â³</div>
          <p style="color: var(--text-secondary);">${t('common.loadingCategory')} ${getCategoryName(category)}...</p>
        </div>
      `;

      try {
        if (category === 'all') {
          // åŠ è½½æ‰€æœ‰çƒ­é—¨åˆ†ç±»
          container.innerHTML = '';
          const categories = ['hearts', 'stars', 'flowers', 'kaomoji'];

          for (const cat of categories) {
            const section = createSymbolGridSection(cat);
            container.appendChild(section);
            await loadSymbolsForGrid(cat, section);
          }
        } else {
          // åŠ è½½å•ä¸ªåˆ†ç±»
          const section = createSymbolGridSection(category);
          container.innerHTML = '';
          container.appendChild(section);
          await loadSymbolsForGrid(category, section);
        }
      } catch (error) {
        console.error('Failed to load symbols:', error);
        container.innerHTML = `
          <div style="text-align: center; padding: 4rem 2rem;">
            <div style="font-size: 3rem; margin-bottom: 1rem;">âš ï¸</div>
            <p style="color: var(--text-secondary); margin-bottom: 1rem;">${t('common.failedToLoadSymbols')}</p>
            <button onclick="location.reload()" style="
              padding: 0.75rem 1.5rem;
              background: var(--accent-color);
              color: white;
              border: none;
              border-radius: 8px;
              cursor: pointer;
              font-weight: 600;
            ">${t('common.retry')}</button>
          </div>
        `;
      }
    }

    // åˆ›å»ºç¬¦å·ç½‘æ ¼section
    function createSymbolGridSection(category) {
      const section = document.createElement('section');
      section.className = 'symbols-section';
      section.style.cssText = 'margin: 3rem 0;';

      const title = getCategoryName(category);
      section.innerHTML = `
        <h2 style="
          font-size: 1.75rem;
          font-weight: 600;
          margin-bottom: 2rem;
          color: var(--text-primary);
        ">${title}</h2>
        <div id="symbols-${category}" class="symbols-grid" style="
          display: flex;
          flex-wrap: wrap;
          gap: 0.5rem;
          align-content: flex-start;
          opacity: 0;
          animation: fadeIn 0.6s ease-out forwards;
        ">
          <div class="loading-state" style="
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
          ">
            <div style="font-size: 2rem; margin-bottom: 1rem;">â³</div>
            <p>${t('common.loadingSymbols')}</p>
          </div>
        </div>
      `;

      return section;
    }

    // ä¸ºç½‘æ ¼åŠ è½½ç¬¦å·
    async function loadSymbolsForGrid(category, section) {
      try {
        const response = await fetch(`${API_BASE}/${category}`);
        const result = await response.json();

        if (result.success && result.data) {
          const container = section.querySelector(`#symbols-${category}`);
          const symbols = result.data.symbols;

          // æ¸…ç©ºåŠ è½½çŠ¶æ€
          container.innerHTML = '';

          // æ¸²æŸ“ç¬¦å·å¡ç‰‡
          symbols.forEach((symbol) => {
            const card = createSymbolCard(symbol, result.data.color);
            container.appendChild(card);
          });

          // ç»‘å®šå¤åˆ¶äº‹ä»¶
          bindCopyEvents(container);
        }
      } catch (error) {
        console.error(`Failed to load ${category}:`, error);
        const container = section.querySelector(`#symbols-${category}`);
        container.innerHTML = `
          <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
            <p style="font-size: 1.5rem; margin-bottom: 1rem;">âš ï¸</p>
            <p>${t('common.failedToLoadSymbols')}</p>
          </div>
        `;
      }
    }

    // åˆ›å»ºç¬¦å·å¡ç‰‡
    function createSymbolCard(symbol, color) {
      const card = document.createElement('div');
      card.className = 'symbol-card-wrapper';
      card.innerHTML = `
        <div class="symbol-display" style="
          font-size: 2rem;
          margin-bottom: 0.75rem;
          text-align: center;
          color: ${color};
          word-break: keep-all;
          white-space: nowrap;
        ">${symbol.char}</div>
        <div class="symbol-tags" style="
          display: flex;
          gap: 0.35rem;
          justify-content: center;
          flex-wrap: wrap;
          margin-bottom: 0.75rem;
          min-height: 20px;
        ">
          ${symbol.tags.slice(0, 3).map((tag) => `
            <span style="
              font-size: 0.6875rem;
              padding: 0.2rem 0.5rem;
              background: var(--bg-color);
              border-radius: 8px;
              color: var(--text-secondary);
              white-space: nowrap;
            ">${translateTag(tag)}</span>
          `).join('')}
        </div>
        <button
          class="copy-btn"
          data-symbol="${symbol.char}"
          style="
            width: 100%;
            padding: 0.5rem 0.75rem;
            font-size: 0.8125rem;
            font-weight: 600;
            background: transparent;
            color: ${color};
            border: 1.5px solid ${color};
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
          "
        >
          ${symbol.popular ? 'â­ ' : ''}${t('common.copy')}
        </button>
      `;

      card.style.cssText = `
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 0.4rem 0.6rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: inline-flex;
        flex-direction: column;
        align-items: center;
        width: fit-content;
        min-width: 60px;
        box-sizing: border-box;
      `;

      // æ·»åŠ æ‚¬åœæ•ˆæœ
      card.addEventListener('mouseenter', () => {
        card.style.transform = 'translateY(-4px)';
        card.style.boxShadow = '0 12px 24px rgba(0, 0, 0, 0.12)';
      });

      card.addEventListener('mouseleave', () => {
        card.style.transform = '';
        card.style.boxShadow = '';
      });

      return card;
    }

    // ç»‘å®šå¤åˆ¶äº‹ä»¶
    function bindCopyEvents(container) {
      const buttons = container.querySelectorAll('.copy-btn');

      buttons.forEach(btn => {
        btn.addEventListener('click', async (e) => {
          const target = e.currentTarget;
          const symbolChar = target.getAttribute('data-symbol');
          if (!symbolChar) return;

          try {
            await navigator.clipboard.writeText(symbolChar);
            target.textContent = 'âœ“ ' + t('common.copied');
            target.style.background = 'var(--accent-color)';
            target.style.color = '#ffffff';

            setTimeout(() => {
              target.textContent = target.dataset.originalText || t('common.copy');
              target.style.background = '';
              target.style.color = '';
            }, 2000);
          } catch (err) {
            console.error('Failed to copy:', err);
            target.textContent = 'âœ— ' + t('common.copyFailed');
            setTimeout(() => {
              target.textContent = t('common.copy');
            }, 2000);
          }
        });

        btn.dataset.originalText = btn.textContent;
      });
    }

    // æ·»åŠ åŠ¨ç”»æ ·å¼
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .symbol-card-wrapper:hover .copy-btn:hover {
        transform: scale(1.02);
        background: var(--accent-color) !important;
        color: #ffffff !important;
      }

      @media (max-width: 768px) {
        .symbols-grid {
          gap: 0.4rem !important;
        }
      }
    `;
    document.head.appendChild(style);
  </script>
</Layout>