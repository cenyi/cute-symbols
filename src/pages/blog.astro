---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { getTranslations } from '../i18n/utils';

const { t } = getTranslations('en');

// Get all blog posts for English
const allPosts = (await getCollection('blog')).filter(post => 
  post.data.lang === 'en'
).sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// Group by category
const postsByCategory = allPosts.reduce((acc, post) => {
  const category = post.data.category;
  if (!acc[category]) acc[category] = [];
  acc[category].push(post);
  return acc;
}, {} as Record<string, typeof allPosts>);

// Featured posts
const featuredPosts = allPosts.filter(post => post.data.featured);

// Page translations
const pageText = {
  title: "Blog - Cute Symbols Guides & Tutorials 2026",
  heading: "Cute Symbols Blog üìù",
  description: "Complete guides, tutorials, and tips for using cute symbols on Instagram, TikTok, Roblox, and more!",
  featured: "‚≠ê Featured Guides",
  allGuides: "üìö All Guides",
  guides: "Guides",
  readMore: "Read More",
  minRead: "min read"
};

// Category translations
const categoryText = {
  instagram: "Instagram",
  tiktok: "TikTok", 
  roblox: "Roblox",
  discord: "Discord",
  wechat: "WeChat",
  twitter: "Twitter/X",
  "social-media": "Social Media"
};
---

<Layout title={pageText.title} locale="en">
  <div style={{
    maxWidth: '1200px',
    margin: '0 auto',
    padding: '3rem 1rem'
  }}>
    <!-- Page Title -->
    <h1 style={{
      fontSize: 'clamp(2rem, 5vw, 3rem)',
      fontWeight: 700,
      marginBottom: '1rem',
      textAlign: 'center',
      background: 'linear-gradient(135deg, #ff6b9d 0%, #c06c84 100%)',
      WebkitBackgroundClip: 'text',
      WebkitTextFillColor: 'transparent',
      backgroundClip: 'text'
    }}>
      {pageText.heading}
    </h1>

    <p style={{
      textAlign: 'center',
      fontSize: '1.125rem',
      color: 'var(--text-secondary)',
      marginBottom: '3rem',
      maxWidth: '600px',
      marginLeft: 'auto',
      marginRight: 'auto'
    }}>
      {pageText.description}
    </p>

    <!-- Featured Articles -->
    {featuredPosts.length > 0 && (
      <section style={{ marginBottom: '4rem' }}>
        <h2 style={{
          fontSize: '1.75rem',
          fontWeight: 700,
          marginBottom: '1.5rem',
          color: 'var(--text-primary)'
        }}>
          {pageText.featured}
        </h2>

        <div style={{
          display: 'grid',
          gridTemplateColumns: 'repeat(auto-fill, minmax(320px, 1fr))',
          gap: '1.5rem'
        }}>
          {featuredPosts.map(post => (
            <a
              href={`/blog/${post.slug}`}
              style={{
                display: 'block',
                background: 'var(--card-bg)',
                borderRadius: 'var(--radius-lg)',
                padding: '1.5rem',
                border: '2px solid var(--accent-color)',
                textDecoration: 'none',
                transition: 'all 0.3s ease',
                boxShadow: 'var(--shadow-md)'
              }}
              class="blog-card"
            >
              <!-- Category Badge -->
              <span style={{
                display: 'inline-block',
                padding: '0.25rem 0.75rem',
                background: 'var(--accent-color)',
                color: '#ffffff',
                borderRadius: '4px',
                fontSize: '0.75rem',
                fontWeight: 600,
                textTransform: 'uppercase',
                marginBottom: '1rem'
              }}>
                {categoryText[post.data.category as keyof typeof categoryText] || post.data.category}
              </span>

              <!-- Title -->
              <h3 style={{
                fontSize: '1.25rem',
                fontWeight: 700,
                marginBottom: '0.75rem',
                color: 'var(--text-primary)',
                lineHeight: 1.4
              }}>
                {post.data.title}
              </h3>

              <!-- Description -->
              <p style={{
                fontSize: '0.9375rem',
                color: 'var(--text-secondary)',
                marginBottom: '1rem',
                lineHeight: 1.6
              }}>
                {post.data.description}
              </p>

              <!-- Meta Info -->
              <div style={{
                display: 'flex',
                gap: '1rem',
                fontSize: '0.875rem',
                color: 'var(--text-secondary)'
              }}>
                <span>üìÖ {post.data.pubDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</span>
                <span>‚è±Ô∏è {post.data.readingTime} {pageText.minRead}</span>
              </div>
            </a>
          ))}
        </div>
      </section>
    )}

    <!-- All Articles (by category) -->
    <section>
      <h2 style={{
        fontSize: '1.75rem',
        fontWeight: 700,
        marginBottom: '1.5rem',
        color: 'var(--text-primary)'
      }}>
        {pageText.allGuides}
      </h2>

      {Object.entries(postsByCategory).map(([category, posts]) => (
        <div style={{ marginBottom: '3rem' }}>
          <h3 style={{
            fontSize: '1.5rem',
            fontWeight: 600,
            marginBottom: '1rem',
            color: 'var(--text-primary)'
          }}>
            {categoryText[category as keyof typeof categoryText] || category} {pageText.guides}
          </h3>

          <div style={{
            display: 'grid',
            gridTemplateColumns: 'repeat(auto-fill, minmax(300px, 1fr))',
            gap: '1.25rem'
          }}>
            {posts.map(post => (
              <a
                href={`/blog/${post.slug}`}
                style={{
                  display: 'block',
                  background: 'var(--card-bg)',
                  borderRadius: 'var(--radius-lg)',
                  padding: '1.25rem',
                  border: '1px solid var(--border-color)',
                  textDecoration: 'none',
                  transition: 'all 0.3s ease'
                }}
                class="blog-card"
              >
                <h4 style={{
                  fontSize: '1.125rem',
                  fontWeight: 600,
                  marginBottom: '0.5rem',
                  color: 'var(--text-primary)',
                  lineHeight: 1.4
                }}>
                  {post.data.title}
                </h4>

                <p style={{
                  fontSize: '0.875rem',
                  color: 'var(--text-secondary)',
                  marginBottom: '0.75rem',
                  lineHeight: 1.5
                }}>
                  {post.data.description.slice(0, 120)}...
                </p>

                <div style={{
                  display: 'flex',
                  gap: '0.75rem',
                  fontSize: '0.8125rem',
                  color: 'var(--text-secondary)'
                }}>
                  <span>üìÖ {post.data.pubDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</span>
                  <span>‚è±Ô∏è {post.data.readingTime} {pageText.minRead}</span>
                </div>
              </a>
            ))}
          </div>
        </div>
      ))}
    </section>
  </div>

  <style>
    .blog-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
      border-color: var(--accent-color);
    }

    @media (max-width: 768px) {
      div[style*="grid-template-columns"] {
        grid-template-columns: 1fr !important;
      }
    }
  </style>
</Layout>